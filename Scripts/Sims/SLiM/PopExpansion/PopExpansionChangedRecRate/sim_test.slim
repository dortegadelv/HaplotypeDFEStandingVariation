
// set up a simple neutral simulation
initialize() {
    initializeMutationRate(1.2e-08*(2.31/3.31)*5);
    initializeTreeSeq();

    // m1 mutation type: nonsyn
    // muts added at 2.31/3.31 the mutation rate, syn muts added w/msprime
    initializeMutationType("m1", 0, "f", 0.0);

    // m2 mutation type: adaptive
    initializeMutationType("m2", 0.5, "s", "return runif(1,0.00125, 0.0125);");
    m2.convertToSubstitution == T;

    // m3 mutation type: cnc with DFE from Torgerson et al., 2009
    initializeMutationType("m3", 0.5, "g", -0.001036043 * 5, 0.0415);
    m3.convertToSubstitution == T;

    //genomic element: exon and uses a mixture of syn and nonsyn at a 1:2.31 ratio (Huber et al.)
    initializeGenomicElementType("g1", c(m1), c(1.0)); // no synonymous muts

    //genomic element: cnc
    initializeGenomicElementType("g2", c(m3), c(1.0));

    //read in exon and recomb info
    info_lines = readFile("/project2/jnovembre/diegoortega/HaplotypeDFEStandingVariation/Scripts/Sims/SLiM/PopExpansion/PopExpansionChangedRecRate/sim_seq_info_test.txt");

    //recombination
    rec_ends = NULL;
    rec_rates = NULL;
    for (line in info_lines[substr(info_lines, 0, 2) == "rec"])
    {
        components = strsplit(line, " ");
        rec_ends = c(rec_ends, asInteger(components[1]));
        rec_rates = c(rec_rates, asFloat(components[2]));
    }
    //multiply rec rates by scaling factor
    initializeRecombinationRate(0.5*(1-(1-2*rec_rates)^5), rec_ends);

    //exons
    for (line in info_lines[substr(info_lines, 0, 2) == "exo"])
    {
        components = strsplit(line, " ");
        exon_starts = asInteger(components[1]);
        exon_ends = asInteger(components[2]);
        initializeGenomicElement(g1, exon_starts, exon_ends);
    }

    //conserved non-coding
    //maybe incorporate this later
    for (line in info_lines[substr(info_lines, 0, 2) == "cnc"])
    {
        components = strsplit(line, " ");
        cnc_starts = asInteger(components[1]);
        cnc_ends = asInteger(components[2]);
        initializeGenomicElement(g2, cnc_starts, cnc_ends);
    }
}


1:10100 fitness(m1) {
    h = mut.mutationType.dominanceCoeff;
    if (homozygous) {
        return ((1.0 + 0.5*mut.selectionCoeff)*(1.0 + 0.5*mut.selectionCoeff));
    } else {
        return (1.0 + mut.selectionCoeff * h);
    }
}


// burn-in for ancestral population
1 early(){
setSeed(c(9150252387453,2905136039450,8861844131251,7363728456443,8189369267897,3804058642191,6990536013589,6180020571063,3313454440308,5105924068788,7265221561951,7301583044249,495646973678,6929329043548,6193998594600,3359928091773,5782594350587,9223501038394,5813453181813,2645156512230,7012872866253,6544975385433,4232922691833,9326551097321,8229949761821,4891200650477,7431403581974,7040229665350,782528131810,2044736168761,8991357348229,2760241472221,7396120123246,9430626527757,7940381717678,4952835500296,4759426297353,659554970847,4651412538017,9249458804494,8239943700923,6403265204362,2413263512633,6496376042655,8459547547874,8582088592536,4689807568960,1903972179203,4417179910082,8898856449092,8714522936427,3749157641779,6681476344845,2209234017028,7805351964359,6256070054342,3676332834254,5498598630160,3271184817048,3675841888716,9646343437861,1507541059218,1344642017982,2730380193289,5237864592624,8822987559466,5585536187022,7427456544258,9873072227828,752461273092,2315277261898,9705120434763,3814693457146,2190644643187,8227479042648,4654502669108,772011173110,6398473277557,2685742931172,3075534502798,1162539393734,9126332142351,7031811782873,7304663712569,5601884673740,634510035708,8909511032007,6943151572464,455113231040,3837233416398,5820123092484,1807521797705,2871291019132,5717850702966,1621821548924,8263651743583,5479634509230,2717606199001,646425618272,9246498671071,7276937608987,3453220841400,9484411495648,2267968923277,5128357425271,8501588325706,944184773778,8876612680780,6903697203952,2594393246649,4469441487947,1858404174159,267993916895,7391548009439,7890970562331,2660997816918,3638830341038,8689923715034,9573229746489,552835226500,7211632819692,6723837042688,7784484902816,2206839768270,2043275129368,8207077837104,2287707502564,552084885360,7968528858086,7388248555812,3867790937537,8807440597606,416426078076,6629295692377,7797742983060,5792630706614,5293474607011,7904236442516,3674369934474,7343189527950,7177906321558,7188462955615,1366471331262,4994618815101,9105880400263,9004818308535,1634888723994,909110729240,7009956033743,5108911703414,6352396683035,5919811169634,3789586641312,3856229164826,1880587514658,4965359188929,5810121905992,4814905164362,7073215039585,9837429236627,8789316386799,6985017380141,158652317154,183573716827,3775205756911,1083232288466,6986259078246,2884679129861,1819324310307,907608024197,3408924102119,1129417204784,6577328549818,8372276819054,1794123090719,4911287188526,9578020794748,3182330683145,4139968748064,6059970583668,681304178380,7515376804898,6732477497575,5041720403454,312233046405,9942688717885,1305324513751,2956970724492,2048910814176,335432594227,9663215428295,3023664798118,1732644237095,8686668529232,3633693453071,5064565658174,9606811461500,6339878960308,7532403471158,4247946802290,3715966886112,8500168117448,669358713704,1281602405842,4289478088866,5194444250703,9845674712221,9324828523802,2302993831045,5682695834614,4812468654363,8445110912958,9964517247882,7560285448303,3519642517600,2807836595666,2562298497803,4776698444725,7179762562414,3064795156998,1862393546366,5360058955947,3160614177312,1912778094575,5577821623517,6589924740272,9925097150581,3522731087755,7565702434976,3982456508335,5756524063370,2945036209964,2568721983719,5380912761024,8158377285967,9638875626642,5582820350841,8829420503966,2651474103660,8707204718976,3100699236471,1777530083791,3958438301222,1885461911459,772444804710,2524992556125,6871562030482,293089981930,1090527856570,9168010140303,211931260437,3449402105114,3938739043510,2676840144893,6086641101695,9595641474044,9545885326782,6850972824426,7771945566769,3991986344883,1119572948849,1135828743508,9572187157749,4672266096916,3255657745404,8147335896255,1535359439158,8860773124858,3668180524713,3692729724893,536761115106,5352074723845,2566344502909,6546633394281,3537469127886,1249874680378,6215489061087,2034059061498,4510499360869,497688614030,9890408356812,8740226347960,5291421976748,2792759322177,4390090892026,4136556579694,9439143525109,8973443226834,903864993471,9064214659055,2866793922617,1058437997863,399398513106,9066003117250,899074650563,4036629432204,6222308934512,3773613301904,2568661035475,389310146298,6480564839217,8931299763307,524618884496,7595212532128,7271416771663,5588579426207,2647703071174,6912032579713,4642270519390,7608590269295,5329124804778,7575926765088,7542278335018,5317067273072,9715859604796,2193803235766,498885149271,327788971322,2137011501066,9423203015711,765611833169,1743853195561,9437056990057,4859897612047,6178030557912,6481450871203,5832514285325,8475742816840,2328167496463,176180200775,121528441358,6225542074933,3335806373757,1312699959960,8564430246298,7381644821919,5871635648549,1449785621969,657633459966,8087281838045,1375263179121,7816464483952,4478298469610,5981472777566,4544713477882,1921232626751,6921907556956,7155259796391,2551543507141,1156592658339,8627378823449,8530274588473,6036489072670,2704951674323,3869483704349,148802730321,1300190870602,2111382896879,5704292093273,5736785621935,742876963759,7363085895663,6208994543357,2966346092499,7703094664115,6853078628251,7498019021110,3906427753178,672497621461,6373620810038,8945536141823,7919620434761,1293926504855,35938592510,5264925580958,4929673785276,6177961374707,9043192223338,9837514743878,4641820716202,5833710126326,2143621822138,2194218182265,6105208631552,3663389966083,6090828065880,6650871857911,8684488644053,489359830323,537551138122,3501259817759,4458500827732,7813698407163,2999555002932,8950697191092,6161296746321,5373516970096,1187643116479,476055094763,8904737582824,2009595487754,7809802365548,884044444396,6540611760641,5278463179673,8035981267596,295981579537,1776409213889,152455096997,1885871089205,1136525036849,7688431884604,7275975990263,4032156263765,4341994512271,969369742644,4490734580251,6799797428199,4471865735722,6456296574683,6522739035629,2271538100630,4910823454560,8966067142441,4684089298484,4979541868547,3792603954075,4212360701928,7982696987330,620094877423,9356175582414,7008597880719,6754156711058,9361620011926,6410792074840,9256302898063,7353898727440,9210055249052,7788277368429,2361633451730,3207882648667,3041047382907,5290733320998,2729320965564,1037185264798,4709897412831,4481810902831,1907050833641,119508782425,6904773165481,3104723128723,2305147767308,1683343749826,3059537548903,5723402060016,275741802292,1128122413858,949005298246,5022034475365,125710305655,3684559999281,9569454470319,2720422443320,2521570273057,1495224174520,4749746113612,6946114638792,3965667009818,973374166967,6148108612901,9335870038576,5280912887581,7202020873865,9043651911065,118245621951,1449897194432,2918611332786,3953042780688,6041517551948,3320695667734,6900898950711,3362603693509,2563450135604,9442730986305,5285632201665,1250063205556,6656795390757,7164421166815,7092191175350,7793725698263,6825913200231,7578015046643,337267552176,7017390144076,9090346829041,6609771554591,9160510450424,262044890470,9497583908004,7052875544737,6647784290449,4898065579874,4192899973859,8826068129452,4712178829429,9369596202588,6201589263277,1209393255937,8090814622907,4118503608495,396560301832,2854657901558,1031621475556,8229016971913,7054751014195,6688158474941,2579463400785,7903261256287,2945788663850,40694520933,6189442281429,840169823707,2541925569754,6498955395404,1547405872163,8381075354796,5566970297481,621522777274,5713895892407,6005580638931,132280826674,2684589307985,5267724106237,9529922139490,7394789413286,7905233705507,646937856304,9054079238921,9984342523114,9026621661512,5653620289880,6237155955264,6835794540525,8515676467911,7153696680055,4180448663087,3861091651775,2913134263552,6745743630294,3385322632272,3804289940281,2998520510227,3237899966615,176824935022,9002072679550,7183153479733,9142318830283,1378274220202,2607515263493,4535902255166,8165890931334,2791639695559,519302174697,8261011080366,1954961413398,6558885081223,9295128471896,2649968503609,5921843455794,9685665400686,5543898509310,3037274845684,861500508758,4397594182046,3366506218240,5276361597170,9064355441967,5843630422637,4965920898419,5880718778706,8464452896017,121337401692,8250892147057,3699549733692,1988260406632,4789056800054,5524147625097,5850201219393,704827397628,5743809578460,7014774184889,8159411305899,8127996263201,4750872521171,7207092926208,915331123846,5794714748847,78791160612,9814309801614,403650457102,1075627926914,6656551901329,3332411740853,3450591953844,404391504640,2411123767178,821136030802,8380770066675,6210155383491,8425399285710,7332974987011,8336423140902,3154033400326,8715876854613,796595474211,3539551186951,7303285013348,5243923359425,8151422288973,8581264504789,9915713030568,3478570569433,8449332687513,7500045399764,5651551737871,1790444659022,3025552368030,7754502084944,8041034083259,6595507279349,1586742610214,1779825731011,3053071421889,6053521317378,466982762838,1594316150266,1691434570633,8255811746448,3166216009949,5983666461813,7721683661031,8123305339446,1460421322280,927718122133,3012525623661,6496569667951,5590054924732,7003773050596,571871163537,4211435817412,1296449185737,8135616399055,6237818580735,2143504238182,64250980472,9144227769092,572971961644,3766447839386,6489310538454,8287239991352,4256348065298,4525996234591,2298874812507,7481715542096,5920420049430,2065557795051,1507295987162,9702727287482,7397974774323,6161541533368,5672951573330,3161502093997,7133671886838,5513804098298,7391303548520,7608824363662,7506704078551,9917402964604,232363143186,7657906976863,2672433844823,1714957169770,9617648246856,4830516901221,3436264681760,2377689667553,5183981437399,2474938168134,330910893853,1290440506424,1074903046216,7429339801696,8646036434049,1522430289628,2952354902983,3179430496291,3520420817078,3750145269727,6069874774178,16713969389,3345900338968,6282040560699,787898169259,695484465449,4674668414850,3659529079482,544614364588,3674595642628,9669770025313,6322068687882,3281843817508,9213169084375,660052551897,4839316999371,9180711419450,3672876922598,377626689291,5762280262804,5704506332614,6533274378327,7791996747293,6597907058627,5562366737059,6076229589842,7105972904474,3649626245953,6742113326457,6331267991986,4684041819656,7273156118291,9727809866125,6114683387112,5000032663624,8041531311953,2093490779197,5704040258158,7103551379041,4629296470497,3525465974370,3772054189532,6317703897968,5653296630989,5221734570841,5058556743125,6597346602817,9185468765232,7099021807110,6926424364593,3435246958169,1882400959621,4414689647546,8928640661804,6956433210433,5996545985994,2844812357018,9685555811661,2559141596733,493696864477,8725931892111,7557944341206,6702956069478,4943340159508,5261211580994,4548080947246,1902026806424,5231061574957,6475746328109,3130583762648,7071994255516,207495270249,9406445612063,2639679095284,4039293140503,6602094976846,3771118151669,6157598109779,4969797754936,5419811597813,8928948907955,1534396116051,5190518306641,9008128746400,6028191465232,9525663189827,4414858100306,3685643809192,2549765379108,3623454278129,296679533006,4355006681154,6209291224206,8343691978477,640489658882,7315634154686,2055457576628,6061259798698,257887580999,8440653100592,1783683884222,1491736778399,1309216539845,6161956065052,7557000342689,7355286096639,2568030990434,9749516048945,8903893445825,8325190748502,1096472602620,6041394531077,7195037018271,9504846715569,5315860486694,2060292247527,6480128943992,8563920773296,3449061691697,9781682419821,7883571436706,3089837961051,9538668994307,2734061705812,9767948301651,3470291534288,5129148916443,8762732206033,8305602061352,6792687529474,3629544878088,6655953737454,9993539684755,4814916664578,5185913305092,1827755327550,2377044457361,985165367509,5438073773232,5784693667859,4421391983048,7959572655084,6664739518568,42745159584,796832465120,3343885514777,503989982195,7800159266601,1928744518719,7218399348404,1233298994352,1799884241647,2829984179175,5387997376245,740112514552,7342536345360,6656875089722,4572219383047,1662155285448,5021043164379,6346091899223,9311914560880,3391724899746,765430764880,8981611401476,6995557990157,5536614763154,3597381846348,4281547415324,2288689959550,8109496868602,6221555403542,9515056709182,4618746888811,5175641999594,1542087824521,9553473982603,7211839838965,9481877373015,7676722665612,2629720093909,5769589754313,4862684283975,7678900154419,6281797479613,2859799781294,2586514567837,5373391149639,3286928612985,7308729110756,2081599088965,4047823764459,7419758387317,7010230171570,4715482671873,872846285065,2534497405495,9081057726308,1309211969429,2129987669181,2400472974446,9519980754188,3258639681030,574429002745,9587280650582,7720420656109,8450207882648,1966466367968,2838888397042,4925232145874,7651808786137,1531840416508,653223560291,5543588664661,2198133352356,5900864141549,2260227433456,794058373893,8519827362411,9067340506267,7318576811240,437501294074,6140681633340,5992163904473,9900202043197,7430268763595,9734939690400,3078292422761,4372101133048,6073936239930,4386547109628,3184609857068,3430232857993,7582220973479,2542354565517,7657601847656,7943880844053,1997397122921,6343359959850,4748610199445,3012161924942,9781096475314,2216670928984,5530317436823,6043148702948,5932014703875,6248942264994,6660189030818,4036646092248,3320858374197,2922036094816,9659135995447,82234947612,2238519641727,1823620612210,115537036139,4062508431040,671689570460,7031869905729,4429551644553,3864601264664,3884132081656,6957915199913,3571207700308,8066475952959,850468832820,6307173351839,4167395602082,5420426408960,1701154881110,5165184502977,7510380584499,7169288951934,8425534870859,287256091904,4005400050163,7465815850144,8441658593170,8503067427113,5331798011453,3464393901001,429941747070,5241949166810,3487998854374,8979545016703,3109836615863,506617407761,3522804326159,3857987998234,3944562960668,4845127694834,6937033712304,8071867624084,8656101972204,5450354347206,5893421044422,5376849951744,1140522058084,61797289012,5099810608172,2650218977030,9630969157564)[simnum]); //define with -d simnum=$SGE_TASK_ID
sim.addSubpop("p1", 1000); }
10000 {
p1.setSubpopulationSize(10000);
}


10020 late() {
    sim.treeSeqOutput("/project2/jnovembre/diegoortega/HaplotypeDFEStandingVariation/Scripts/Sims/SLiM/PopExpansion/PopExpansionChangedRecRate/trees_test_" + simnum + ".trees");
}
