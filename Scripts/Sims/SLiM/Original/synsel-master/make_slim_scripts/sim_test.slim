
// set up a simple neutral simulation
initialize() {
    initializeMutationRate(1.8e-08*(2.31/3.31)*10);
    initializeTreeSeq();

    // m1 mutation type: nonsyn
    // muts added at 2.31/3.31 the mutation rate, syn muts added w/msprime
    initializeMutationType("m1", 0, "g", -0.01026, 0.186);

    // m2 mutation type: adaptive
    initializeMutationType("m2", 0.5, "s", "return runif(1,0.00125, 0.0125);");
    m2.convertToSubstitution == T;

    // m3 mutation type: cnc with DFE from Torgerson et al., 2009
    // initializeMutationType("m3", 0.5, "g", -0.004594*10, 0.0415);
    // m3.convertToSubstitution == T;

    //genomic element: exon and uses a mixture of syn and nonsyn at a 1:2.31 ratio (Huber et al.)
    initializeGenomicElementType("g1", c(m1), c(1.0)); // no synonymous muts

    //genomic element: cnc
    // initializeGenomicElementType("g2", c(m3), c(1.0));

    //read in exon and recomb info
    info_lines = readFile("/Users/vicentediegoortegadelvecchyo/Dropbox/Documents/DissertationThesis/PurifyingSelection/Drafts/HaplotypeDFEStandingVariation/Scripts/Sims/SLiM/Original/synsel-master/make_slim_scripts/sim_seq_info_test.txt");

    //recombination
    rec_ends = NULL;
    rec_rates = NULL;
    for (line in info_lines[substr(info_lines, 0, 2) == "rec"])
    {
        components = strsplit(line, " ");
        rec_ends = c(rec_ends, asInteger(components[1]));
        rec_rates = c(rec_rates, asFloat(components[2]));
    }
    //multiply rec rates by scaling factor
    initializeRecombinationRate(0.5*(1-(1-2*rec_rates)^10), rec_ends);

    //exons
    for (line in info_lines[substr(info_lines, 0, 2) == "exo"])
    {
        components = strsplit(line, " ");
        exon_starts = asInteger(components[1]);
        exon_ends = asInteger(components[2]);
        initializeGenomicElement(g1, exon_starts, exon_ends);
    }

    //conserved non-coding
    //maybe incorporate this later
    //for (line in info_lines[substr(info_lines, 0, 2) == "cnc"])
    //{
    //    components = strsplit(line, " ");
    //    cnc_starts = asInteger(components[1]);
    //    cnc_ends = asInteger(components[2]);
    //    initializeGenomicElement(g2, cnc_starts, cnc_ends);
    //}
}


1:8900 fitness(m1) {
    h = mut.mutationType.dominanceCoeff;
    if (homozygous) {
        return ((1.0 + 0.5*mut.selectionCoeff)*(1.0 + 0.5*mut.selectionCoeff));
    } else {
        return (1.0 + mut.selectionCoeff * h);
    }
}


// burn-in for ancestral population
1 early() {
    setSeed(c(3877507171594,1126769761466,9095240138144,1482734608407,9378889303517,6627688652371,5774161631505,6351691682585,4218656737033,1297399946296,4584476931072,309699104994,8737267136878,3509082191738,671268434912,7562843757909,7645236000383,8405740638242,655197030361,9398947420672,795947419730,8842600924097,2181681473042,176068310501,5322370831732,4333650024523,8047808937640,9638958646033,7368594981265,4380697235170,1138476321296,6624733440133,5836051047265,247777473632,4342542981647,4722250054584,2725206600098,5831643245323,4861642619845,5169055975871,1016740046238,7502572858690,2784109762359,3831827412751,2412404188630,9817330933695,8397597388814,6977901566332,471993627514,1462631741040,987736460168,5390285406285,966245040962,7306669165379,891933038925,9734284764864,917155528712,3622198944102,9547332284879,7983506642405,9530141836471,3686974079435,9965407306072,9969020379286,8216570561985,5974240613362,6446869188871,9085146691271,2123040495807,193050083028,8405528039583,677650132101,9117253644414,7849688755280,9956758251746,7595374726806,5040091688525,8406239996308,4849431462377,8732229980694,3480945865989,2271886649412,2973283837695,99197321186,9493406752309,49978720130,4781840326993,3544320143392,1334549734028,8096279125493,4236172548864,3312300201789,3764638948044,3676798356205,5748986523233,332762893464,7581810084228,6514576212755,1136132221511,1402284206593,9951916838871,6264384654493,1679721317257,731617920383,4920715871789,1193520851003,88293040843,226466683601,5851439437168,7132333653304,1451774304920,98697177337,2412336635606,7185045972393,98707338386,4828275889574,993875830071,7889158526063,8249487079871,5713822916261,1968479760651,148238989203,7378537605267,9473671602801,9610654021819,5011879472040,2575801220793,9677662633893,1925176997058,9956225486735,6921819380542,133745719027,7787760450183,5117803832833,5104766695707,4749558744015,6936028304298,7069407297238,3362202095832,339360817901,9765401512042,4009987462997,3868531028364,5960295266121,4074718158928,7495724400243,311997693163,4845818337949,6304517717751,7531955318365,4355291501207,3505802060428,5381080432975,1850727678665,4495676713395,5613025915740,4643422322278,6412560649293,4118074967823,3937174190862,6706792664779,1233222943889,8056129747497,8311293350904,1016356250246,296295348153,206036577258,9992972831664,8767213902852,4337440479076,2151106807981,8053728609333,1399634209666,7815843863717,6629851980511,5096615072902,3615708694183,9339132992670,8686457522806,2475543291121,4550290530749,6394070525479,4474728519792,2512495036492,5388895602227,1758121592860,3897674531656,1018824598477,5574155258923,5319895442561,3969077823270,1171306026428,4066985934916,573577258183,5145370965572,8295845425736,1696036120689,2341736699957,891951060931,7029326246781,4184425356283,6009851298488,9046466851598,4452437235194,8098901542678,3733987238034,3911163624756,2034807051107,8287798307692,1556603496377,9903573526566,2399996029767,807573926139,8806586205243,9126780953888,8977359844134,8110646521488,603485515053,754146850945,7776070677018,1910178193124,2934362571133,337727725140,8184720494299,8787492387065,223271617702,8358380129691,6035465481539,5711876891521,8937677131897,3503436972170,7251453642883,6620199069306,140299242660,1679988773601,6887147744572,1225840784876,7201058206721,9719781204137,5650538707492,3935617361568,8491302782371,8778649087611,2011582955028,2908770260350,1356474584413,4536586437547,9852624097832,9875765259573,8495528136232,138232093880,2199230203605,3097599718787,6597337392734,9807255658313,6847122698698,2940626802196,9392554630662,8904706739061,1431514612449,6620172000710,5972347126117,4993221200633,7970374568033,8218586928669,7068637667561,545227911792,4774958766238,2673793731329,5594577412152,1388597766084,7039600652918,4716708332256,1231493750921,7894442359087,2179896029205,4484865691664,4054734239027,5986401183389,6037112910672,8843630673409,1724623336588,3470453284247,4491415339341,4928456857692,1653217730553,5917789579441,4746156755229,1007290412593,3106042105442,3651935982980,4043641025048,2303013740484,3959856795208,1040208517294,1763772336069,9724003864986,5378061282919,7238904919209,9325397518361,7638170087339,4900138337015,1873911836559,2186128155945,6646230803513,5421742905187,4468094539596,9119820531888,8488950522154,3619459464715,8494869604140,9949328790500,3965792217946,2621731300142,8086311645113,6021287815902,8920972871846,8601661608480,7230343966485,2127382324336,1940066219386,4693001842726,27410886811,8468251754456,5995012591141,2095642358693,5586989912614,8351558885000,3747958650251,6891581012642,7727859911204,5228160210400,7570870476040,3041326132507,8766058387590,3263384314119,9491880984681,7907362493774,3077419812766,9683492822733,9161396485571,7326280502143,6107205877788,5386277373647,862012187719,6802626422128,170604540263,4464827653052,774011723286,5555611861387,7910932041414,5365464935748,8527922474068,1721686721216,6679415411620,5063799486368,9997563713302,3589247135400,3129395834938,3073665418058,8318098676496,9815404902503,7928437687470,9821221894095,1211223502965,5067112627509,4520210857782,4210736194304,7525514105547,8235800943979,9027368729664,4787488699527,4265633637148,1288219756039,3584280405650,3587157353477,7945534329126,2847076755810,7652090317881,5926347920245,8846427416827,4382606426786,8675177578827,780036744392,3579383586272,5149559790084,1723503804390,6306205079035,8170642491834,9977534897115,2971855020421,6136311437922,8675902580519,4888891073419,126928350091,7678628232282,8847515188104,166697189593,2701732169920,5917368755838,9820437590128,1216053630368,4817793140459,7154118582267,2300473338775,6843426310958,2393151435630,7104464225487,4737620782633,4910406877512,5075835608859,6756122318806,1235824387326,1491489302448,5586599027438,9719667034628,6275536861569,170769240024,9322369488332,3420082640340,5390537473057,6187678847349,467691195906,6686369376741,7280027501677,421032696774,4096760388249,8294987799491,4040374675148,8242290536482,599228144412,1177390199392,3466025779299,8299958881177,4745141687472,6046431704476,2353516331633,1947119972526,6787689501718,6143799556656,9523488463275,8406235670481,9751412248842,1937248644798,6074766652803,6545617667036,3281583295034,2580213802593,8567767221982,6611204945201,9849045876899,4946579507854,2641530114754,6477063839403,8933666474285,7538179547834,7554482845581,5071462653500,1303675864892,2241304206483,6563304647793,2935185841591,8624270147053,6712941305416,9824653456752,3912973981940,8141949363618,4793382991335,5253299468852,1932340222155,1476737723561,5379512898667,5179921696412,1338731127051,4397958443032,3868646054888,4721129124033,8803173366171,9917443208857,2992058631574,6223794771627,966410864807,4978458832465,7046694126409,9186477777302,110421637087,1706458114587,5296574412839,7579718393637,9237180990683,9765332314252,9282936657002,4309764054895,9819277831776,4702142429530,5555754117658,8902264684149,7550295366160,1350500908709,4475780081691,9451867708136,2606862496647,9712859875335,9969170001437,4444620184249,461966615731,9746755048049,7329787579291,7038311031649,2324942872935,3379795635030,1837209188736,5205077329723,5268036921955,7151026974464,4984383375595,3488438806949,7669865766132,6280088995641,3173823016923,3499769823517,5545597938928,9062275231708,1608149869073,2690004268296,5735163323300,7152042791512,5431767587922,1738804321407,4574641175803,7680916429703,5611122022899,3131857867333,4479665888255,9673221742972,4772457915492,8224390104383,981054359843,5770783167484,7023452662768,6773146749733,3512817183907,9411017391722,6573776585165,5029692980462,5192611027560,1541646182243,7983862140944,6354978666037,9262129384722,8234365392316,2273200639910,4212602761726,8059423768335,6398089464578,2905871154244,3418418852313,3639230089029,9990685194678,6933831492572,6957739177129,526146747455,4841103559295,8897609997386,9919841443815,5407814000977,5252847681556,1172721583844,2352007441290,649605134568,5594230561912,1454196260316,1406819555966,1984576874060,4761313519806,3224570773943,3938730691912,5071667800886,276895203884,4374715044583,8214881149020,6069106062535,9934886832923,5695426821319,7634907579713,3705700762645,1763607668891,2776263088006,3409157753507,8530385639956,6013799762241,7375088439466,1661449727755,239576964990,6694506196157,1688536233142,4529013632194,3585040222989,1590389484777,5321630043078,1136937676311,3785783564268,895804418701,5643012214719,6696093892251,4725766955631,4871125641069,1130990513907,9669997776703,3780022887982,3341077994863,4906036941121,7000894952238,1023946952381,9264164742950,5021270097548,1357259031454,7465268009178,1509196874462,9809483071495,9309530497603,4498325058452,8448937541572,7188683528278,3400048940160,1516920085791,8113173848147,3768165180805,1830766391620,590159774091,201632692247,9795992266229,5623516523808,1708846610820,602144674583,7069882480446,6932350354289,3281192677098,9342163390400,3796730686325,517328419783,3303456070449,9821576584872,1230606726070,4288206305534,3356721942211,3137026502558,2760928453143,2338378986999,2901686765733,3806982586115,8621911197485,2618048737574,8957915200959,1363561301735,7249311755391,4606287202548,9820032412473,459272549792,7776898867854,1665914314022,5581952302297,498524951360,1056296033162,9520341217777,9519403692925,7197726961843,1438250552389,7795457055472,6927220802534,7575341509270,5595420067806,7530683099078,4733395958140,7069939252108,880505405884,7890631669825,2787532283468,7258141316504,2101845560167,2722625264816,5096133250574,4343047457841,5480411133674,7450851058996,5555680133796,1632629646484,1165685400090,6248919060278,4697401231351,30018427739,4419967560832,42422841431,1513650683551,1812338020857,1479061040448,7711323069068,4119322413985,4297286531139,6950877481117,2324511334058,4839979151716,919195067048,4044921207884,8098197503922,6518055310687,7802375228356,9830667098700,3985871380937,8892722707303,6034888745006,9406356211495,658565683221,179250645690,8846444310987,1789719396727,7342144357977,4974223985799,5642385261605,4828536452333,8552082177812,3249860277916,7313865911707,8989185205307,176116177904,1536626791768,5969135046438,7758563080632,7254882187324,607676698306,547448311540,8513150571455,2893119729778,7756418268847,505030450434,108368143340,7335712405744,2051365466371,6932321687875,1855076900093,3804242826148,4029344476963,670986194845,7543329390684,392792989512,5031875953378,6474638392144,322318572069,4454314365842,472386830989,2399752867199,4280642609658,2960263945861,7939721246408,2994068945530,7315578401561,6386024603089,5875024140612,3472721670588,6252474521552,7405778764109,8339841421433,154728236778,3241880411403,4648200554640,617015228898,9313375017407,5890550046300,7165098521961,4745042270812,7003436998406,8664525845164,8908680596571,2835571529957,9544442937721,7528322011729,5107168908617,9857812108535,1717488239103,5900051688849,6095846438405,6099446050964,9005659692184,4345042087032,4987045787719,6809211740420,2538522946950,5064578973351,5207936427664,3339096352563,3103649515197,946795616745,6049648010482,5610868933410,9899114733731,3404749086009,8891355533376,8248598043710,7847429840048,4587562761824,9931217709809,5730920062370,6205076893445,6303879932081,5075668285920,9976091520211,1984190777139,5433218016598,741573671161,3025688120361,2063784678586,5401700784521,9977897045024,7386763345319,70222341452,5550894014926,4717836514545,8410676300964,9620695805577,5794665830789,5080289505453,4338517203246,7399007941597,7236607093467,1029437809767,5326760121706,1741089611904,1875882377443,3715983866800,7342199936543,920225680373,6219594643750,5838262150135,7881531613831,6141698147504,3673248185489,738740073670,4109479967985,2249057924239,5520823448190,137360024197,6769712424653,938232359500,8065724113722,240702827596,5418182360214,6992817548289,4868954658895,3293075509738,6734509755297,9207290130450,9795858921777,186324733992,2700039460716,2363940756929,9168499510675,4316662810028,9353467789530,4754049942668,2985636136591,528654674970,6666076379255,5267125459801,8685637925138,5891993837753,6714312848799,5527801260768,2194574501186,9185058107349,6869735439758,473503783336,4110071794253,3888204011516,3280889718957,9059119935659,8596994068502,5605044194062,1494811558396,2483215003091,5636934856810,1551629467360,1422103426376,2511501536965,7009166174298,4074651894947,7792017488024,4295096409703,4328260971762,9556750239084,3463212652944,1151059556141,8990517329819,8003710330556,1765208212199,6305425297088,467173437740,1513280361589,1361079132158,5529108506746,2380676731361,601055188624,3855014574740,5166488076552,6491766927551,7917585806062,8660101637658,2610186944059,5687846842603,9532660877199,2048047860219,1347058464515,3082948651236,2748565379755,1954238574902,1353478645914,9977890473256,438405003065,1687240216885,5179517752513,8619496298234,6298469057257,7889578487135,3446183283819,6489636500651,8521426030777,3158366111262,5157357423100,9531970465480,5136513599285,8963414993340,7702390477718,1813630314953,2818205283052,6242856882879,8789035442329,4336436146124,5163920761062,7933757530075,890338089215,5121154984405,2266461018198,6156618639592,3265025309288,4765970107532,8509679861096,8628206617083,5815486809914,2332443052411,5676865519172,6808875804081,2924672516384,8658022130408,7683267221478,2952223974541,1975534306097,1671978841825,7007295941420,785395083862,2861473328650,7378158325742,5519654860824,1905703539652,8258807921534,6311315609162,8222709636245,2462059905152,6105145767325,518328996415,3323652090633,8265282936988,9250024132265,7725443411317,6191949383126,3519404741470,2722193563525,7705677663474,4817629926081,4749364924567,3146378316866,653797607307,1720114357298,6302183464121,2675556140641,5457666964140,1708948280245,7654975605057,36644462078,1644505626578,7436913596667,1764654495757,5657628570293,3504389995125,2196066000248,3594426352881,7725960243450,8824311574723,5549545125355,2880664248387,2496016727334,3888151972935)[simnum]); //define with -d simnum=$SGE_TASK_ID
    sim.addSubpop("p1", 730);
}

// after burn-in, split off Neanderthals (p2)
7300 early() {
    sim.addSubpopSplit("p2", 100, p1);
}

// set African population size
8340 early() {
    p1.setSubpopulationSize(1447);
}

// split off Asian-Eur ancestor (p3)
8696 early() {
    sim.addSubpopSplit("p3", 186, p1);
    p1.setMigrationRates(c(p2, p3), c(0, 0.00015));
    p3.setMigrationRates(c(p1, p2), c(0.00015, 0));
}

// Neanderthal hybridization
8739 late() {
    sim.addSubpopSplit("p4", 186, p1);
    p4.setMigrationRates(c(p1,p2,p3), c(0.0, 0.1, 0.9));
}

8740 late() {
    p4.setMigrationRates(c(p1,p2,p3), c(0.00015, 0.0, 0.0));
    p3.setSubpopulationSize(0);
}

//Neanderthal sample
8748 late() {
    sim.treeSeqRememberIndividuals(sample(p2.individuals, 2));
    p2.setSubpopulationSize(0);
}

// Asian founder bottleneck
8808 early() {
    p4.setSubpopulationSize(55);
    p1.setMigrationRates(c(p4), c(7.8e-06));
    p4.setMigrationRates(c(p1), c(7.8e-06));
}

// Asian exponential growth
8808:8900 {
    newSize = asInteger(round(1.048^(sim.generation - 8808) * 55));
    p4.setSubpopulationSize(newSize);
}


8900 late() {
    sim.treeSeqOutput("/Users/vicentediegoortegadelvecchyo/Dropbox/Documents/DissertationThesis/PurifyingSelection/Drafts/HaplotypeDFEStandingVariation/Scripts/Sims/SLiM/Original/synsel-master/make_slim_scripts/trees_test_" + simnum + ".trees");
}
