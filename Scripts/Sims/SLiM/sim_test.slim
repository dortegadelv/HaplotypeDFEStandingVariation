
// set up a simple neutral simulation
initialize() {
    initializeMutationRate(1.2e-08*(2.31/3.31)*1);
    initializeTreeSeq();

    // m1 mutation type: nonsyn
    // muts added at 2.31/3.31 the mutation rate, syn muts added w/msprime
    initializeMutationType("m1", 0, "f", 0.0);

    // m2 mutation type: adaptive
    initializeMutationType("m2", 0.5, "s", "return runif(1,0.00125, 0.0125);");
    m2.convertToSubstitution == T;

    // m3 mutation type: cnc with DFE from Torgerson et al., 2009
    // initializeMutationType("m3", 0.5, "g", -0.004594*1, 0.0415);
    // m3.convertToSubstitution == T;

    //genomic element: exon and uses a mixture of syn and nonsyn at a 1:2.31 ratio (Huber et al.)
    initializeGenomicElementType("g1", c(m1), c(1.0)); // no synonymous muts

    //genomic element: cnc
    // initializeGenomicElementType("g2", c(m3), c(1.0));

    //read in exon and recomb info
    info_lines = readFile("/project2/jnovembre/diegoortega/HaplotypeDFEStandingVariation/Scripts/Sims/SLiM/sim_seq_info_test.txt");

    //recombination
    rec_ends = NULL;
    rec_rates = NULL;
    for (line in info_lines[substr(info_lines, 0, 2) == "rec"])
    {
        components = strsplit(line, " ");
        rec_ends = c(rec_ends, asInteger(components[1]));
        rec_rates = c(rec_rates, asFloat(components[2]));
    }
    //multiply rec rates by scaling factor
    initializeRecombinationRate(0.5*(1-(1-2*rec_rates)^1), rec_ends);

    //exons
    for (line in info_lines[substr(info_lines, 0, 2) == "exo"])
    {
        components = strsplit(line, " ");
        exon_starts = asInteger(components[1]);
        exon_ends = asInteger(components[2]);
        initializeGenomicElement(g1, exon_starts, exon_ends);
    }

    //conserved non-coding
    //maybe incorporate this later
    //for (line in info_lines[substr(info_lines, 0, 2) == "cnc"])
    //{
    //    components = strsplit(line, " ");
    //    cnc_starts = asInteger(components[1]);
    //    cnc_ends = asInteger(components[2]);
    //    initializeGenomicElement(g2, cnc_starts, cnc_ends);
    //}
}


1:1000 fitness(m1) {
    h = mut.mutationType.dominanceCoeff;
    if (homozygous) {
        return ((1.0 + 0.5*mut.selectionCoeff)*(1.0 + 0.5*mut.selectionCoeff));
    } else {
        return (1.0 + mut.selectionCoeff * h);
    }
}


// burn-in for ancestral population
1 early(){
setSeed(c(4853106351723,3494087006779,9058933504216,8408555228491,8724161424056,3166757684113,7220087903600,1990481003776,8067017174877,7884802936490,7366891748168,3864042783671,9305340365263,8158251305835,5434984093441,8047113587069,6118628941387,6251757553344,7069581959327,4067014911836,5777720262482,9070878927531,3132631260087,3204414546895,1574853654488,6292807311707,4093146033672,3632465165992,3117064608542,7917556021933,5592246221714,7522040914591,3136041988052,7607197449710,2216653984579,9659159091747,9331716770450,5391978710590,5192360672791,4876077511270,8485022212428,5323938724873,7642512214075,8351139276079,3733711133129,3618683555524,6445057156681,2458238587888,6288403847637,2871306373993,9136432009479,531240019189,3270686059736,5179951400572,6475430106147,7517585831132,3908841662264,9712670179812,3600779491714,2090912887111,8864282419360,74524698648,1681966712195,3072339155411,9905799615534,2634874479436,5824321260696,2182033184667,5768277149005,4148360228474,5254272910056,3255467588902,5931851995559,9187702368606,620014235225,6893967273381,5333948317781,9041921584226,3034992687674,4521432717805,6672622709925,2744368006523,5109174508395,6258883309173,1747349312705,2812022047981,7928926359956,7500448279161,5365508945748,2731449950769,8611366635851,8793327465482,2996141159263,5013277408118,3959419131565,8900314722664,6003622853112,7873492868818,1728646837338,5514289008457,9329660148634,5093201548505,7416418656209,8156617970304,4101294841725,7583045149860,4713408285320,3348882195400,3168662984463,1937921256432,3773048421416,848312069280,5270504911113,7769209979797,8402349278055,904769194532,8948558472761,7807693335176,7141263305495,8543223418203,5648603395406,1258873433288,1115080228193,2829264652115,2550144867687,8527382810516,4168168186543,1878998589125,1440021133733,676787254042,4986961846054,6113089015205,6612174558236,4311270203846,8337241769181,3045689201466,5306802901934,9938026963028,611449124146,1099938170565,1244287333126,3865519813891,7153225837004,5067556396412,9791339651686,9725370418565,8270478373637,9940089517425,5100617204073,7090635064684,2382857952658,4621253811750,835153118850,7586576335539,81421800746,1889298403592,9261009796454,4871230658827,4965538118131,2708540988346,9832771145991,1298776534035,9510565121613,993855035677,9580033560300,9773720141035,9269814434552,3532261721792,1462725573056,2592117195542,9922956813860,2470243028552,3742522290127,9687945461972,7473789648045,8007442360233,2537051736176,7731389936815,3562490501023,6999568248521,4640247394275,6343852599267,2720765193126,4437049236832,8626430940064,4018569443284,3622234972897,1500600326330,6079367127528,9440551168243,4251200573603,7909915585237,4014068437292,7588076749291,9933234409251,814163753148,3804024743892,711506074296,1995670197267,9070869802133,359121065351,7792408476768,6580506446332,889696364684,7701542191577,9520521356476,33938526695,6428756599495,4164325011878,7458381593294,8234636015521,1431794517639,7906625132312,416546349941,5023860860201,4973786191570,6733193819858,6592169780069,1016334370859,6613978982147,613411101376,6574394522284,1401816469222,5147026189827,5650997546639,6457546544301,7074060243203,4538866779543,9652572102108,8336682471105,7230575025778,8484931370493,6256431516974,306604834210,2192017293064,5629001150211,7290795880926,5893436140238,9932007296035,7398405908622,1691114103003,1024420071547,393993996476,9024122075079,6105886162721,604024660806,6183644027719,5679654833860,5705588320327,1067462787921,9721654404272,690296775563,7320533889578,2130790621097,1357649389444,982922055625,6717450897915,7699211623155,407853508595,6042494325655,4508995474623,6542219553191,828539595995,5794934982365,4740486418787,5706844816736,9682623847243,6687386677770,9594683684310,6479515224646,2163027491950,3859371504382,184201957530,1659244036193,1208040532535,3782945885329,56549891366,4721832398266,7519246121956,2118784916245,5074367341727,1800387739115,6358492094682,6099066078695,8556818608918,1078069413716,7864378983436,9831691080867,7095134953343,8392681411681,9982919435748,2945387328803,2326872455213,1229027040707,5444449372815,5793508027292,4140460582815,7721492463855,2039893252225,1752933680170,4467566187432,2908701888358,3007614151627,8041472194147,2483903515790,3099051856155,1358344610429,4335421346430,5639084447797,464445463579,5521316962400,2895755440401,1287051520461,2708133964322,1475169724686,309999315356,8471562793899,4719676812905,909365690689,6491223150284,6318703172394,3877933008783,7854019332481,7554281183593,8731421061487,3931383984061,6976261332241,1389463511460,1040654468204,1401257034948,9086726056940,8853612617476,7928400381188,4150057755939,4835816071135,3289450707474,69529983216,8768190715201,1353593622725,6805387483414,3403828864224,8801598283727,5868106487381,4959512529235,3142995548738,5145327986665,1730925631710,1546527895488,7623512666893,3299003715616,1132893330624,9684858295757,1163375614025,3137568739971,5757998243319,731403740053,2587836504563,8404573136568,8026344090868,509711644628,2306678959943,746051023751,736498368776,8239085419414,9600345258602,6807215613392,280472473006,8124880423885,9813310696549,2619700177085,683981157850,5086100462050,6054055257569,3243068846603,6214575994599,9585554302146,828142913554,631169205401,9382326299208,4100697703459,9887967164799,190577057226,1999219670756,6331082514934,9318838646562,2265290867577,5892421355601,9034879519675,3706293956685,9018697996442,1102886997407,8929945923627,5214692511465,6574807621394,3669329936105,7966070836082,2787445807680,7744893977303,4932248150701,6407647066637,8252131445206,32291103443,4087289690735,6637961290431,4303742628250,220937090717,3308026116094,7678195258408,5826575855876,2954650958912,2546752147957,3030692733801,1110607982784,8250130584983,1062506877036,8783850803818,3840850655500,7940472842074,8446995231688,2202513629747,1947109019820,3275937604944,3562488303960,5985934745132,1641614974821,258449807731,55777135326,7127742618866,4813272808739,5887717710059,7641162188345,2038732582482,3821423160832,5463116379729,6660139257497,3512236239366,8924432321660,6882796810753,7689042910818,9410310700843,8877218874045,6364341706965,5394312468261,8405172873469,4842174517625,4331667064399,6790227510229,4525629793820,9467962121206,7690979718836,7775010596902,5989875807307,3636133693209,3443347697318,1383091170350,9397362877906,1797457779485,7533194832583,9177032271511,5444924103219,3237258240862,4987607024151,7383956341129,9890691584949,2084415013349,3046758856393,620790852504,7531353739454,6326690561942,580236881116,9006369432520,7139092451095,9169459020643,7762725532624,8918159854444,896856023346,1818973663060,6545728686631,8394497955287,4125326613769,2150343382047,2426382209330,9234445008248,6353939648291,7018299040507,1232507911723,4236318537060,2484407755147,3974648101094,2247827285645,1894463798778,9817556349047,2982213649340,9981589103933,3625850486129,7430313309925,3504837433874,2969326942489,878983172191,4601019068129,4317487724516,9283839826147,5208426452797,1575563363085,363163178375,2137715402695,6789519342723,4402081026199,7830603456386,410858684775,2421716364438,2500616725705,3148719046900,2076493428291,1730069275650,4586516630706,9016131338697,8077541260681,2728397036243,3618871800564,6198499362506,660298964983,1428431055661,7388974960114,8524658962244,4957567512997,9369647422248,5853123815521,3052588997518,6749616669502,3455189182562,181117185765,872086610117,2071162033125,9218856862387,6939184326765,9489651011871,3435752654471,5077881573499,4209121913902,6734758053435,3213906386339,66263323615,7633409251909,2396348931312,8443442622436,3647061472408,9324517041923,9147067284616,8783054349819,5985090978704,533678337587,3490861619540,5194724981438,5752444275277,279631109157,1325731935123,9344808746668,5646729686150,6214496903797,1549449134943,361845096476,6767968187644,5085691964425,8944353765574,9171789078631,9595975444893,8182412421514,8442010791208,4941241369087,579415793987,2272353934107,5024731343168,3197500971678,8618638915087,669850809114,8712988118581,8632808422183,4480637388388,2191056855479,584785325985,3347306560279,6563649092155,4018218350128,1917692515461,2303854533213,4503081709226,7047915474728,9158981685356,3454243252820,2324119258084,4316792535388,4271006031262,4216984374631,9713115104687,7045490542645,3221354160780,7933143511985,2106719430424,979079619186,4431654779648,7938203230563,9054896681705,3238963962856,3570673735159,5726316817484,8760241124002,6618469583736,1006515616720,3070226429568,9130786042745,3005806329861,4798519039150,488698355057,4959722360853,6908532772313,5595323030919,815208840836,2441320384389,5946056945923,5054236144634,9109248075967,1112581128698,8014531315446,2477797505612,5376706950749,8043794288793,119190129462,3770241397430,5544990034963,557253736836,4199378450760,4245059112457,6291275733828,6931103637237,5206138801398,2437863079085,6195308672642,1308272577154,2507842518570,9426793477332,7596765427060,7563754413437,7756287789206,9993794831042,7124836757764,1927043747200,1879403826595,2421972942428,574643188019,6477667824748,5287282208545,9157278024929,7284158632913,1085936250422,9096438134026,9484657480557,1255552714477,3739389594010,9988891488332,8733198695260,8917532121947,2937962017545,8840038275611,389510701051,9017760872746,7638942344097,1400458454119,1753864595005,2660819444723,5567358344243,6975788661331,1995203043497,8067322143034,5640212589423,6087255899410,3244475513477,4136802802402,7406019799237,1309172773167,4661202307602,2891621911082,9421391278483,4507745123749,9770581675101,5179171801125,4808724100167,231385942025,1212809024907,6456914806865,3644135937052,7833887009646,7377202792450,1827985602164,9230296667171,7037368301227,7743212141369,3281800506383,6159301349524,855796360506,2215246493626,5151712589109,4819169106799,1164461989766,1583322174762,8512213900455,6726296364998,6657027304217,2375647234910,5112978015942,9608823572563,131273117283,291766341319,9206583995394,766742971967,4832958691473,9648802300501,6776541297599,782345787558,967391511872,23343829340,7676017392969,9415222237241,8036241780174,3726958357999,1562154187803,4051215818159,1912087865325,703609058371,1898392560417,8278263816193,9860395085973,9981482375735,6984721445926,9674074543305,4808562029185,7736167346131,4701599925145,189414824592,4124994195230,8940081875389,3873861766615,9402239746205,2563732261895,3224088836666,4055728085197,2505257372385,4535057406099,4647961870108,9001492131483,9832518582690,3949325503483,9216533669157,111633850114,6345517920418,5070574299116,6106343353552,2912471347320,1346216466551,2164278683505,4283507116256,5414591651410,2431364180279,6437591851512,2325861297610,2079829527331,2614625971112,5996699511759,4343467653187,7413898868121,5197982322369,8474456477211,1418116473069,7618492238954,7305975121743,5863459004389,2377472313316,4725830825823,6431290862665,792796944740,6724817696850,1255502350111,1510299603046,2407845486973,6021229229161,266327632295,6180310032344,5318341851303,5821388890937,9625999315916,9397493292491,8285293237466,2305150605402,7432568064857,2125422317411,2047303848981,1919392639285,2328857167342,194839047514,7280698190163,9998288737874,691327576308,3404331051759,8566654323906,4748317157854,3216684880380,4147716916332,7314861197583,3542828527027,5678309747755,4050775021146,5371660818595,5648222472172,1748729325327,9779798413117,740337614858,7789273997757,9515643341119,7143324818972,1620533672722,488933715721,8133496553863,4417852430399,5750754154443,6705119657229,4286853603840,4626194381207,3149387706915,7636909962488,6166346968396,4536269710367,7807799751009,3039444829798,4154004519840,2701699618274,2416085570411,2430620883633,2582916549463,9439501009935,2715892405961,3887733473714,8176599028837,7630388112175,6912819536027,3964305477607,2576985303180,9061817880003,881150824232,1864683664390,3912241929188,7364129905114,2640300907669,9397767567880,9772943727408,1475545581571,6393956111115,3077083844341,6544027948396,5899132417839,538177841072,7769123296230,6509315049478,3130690443234,3444514221976,7091925786453,1534097433095,9706429328749,1348430561332,44035414689,784793295869,1480031478770,2022616075174,2378342520461,2356151715358,2557590267804,5986633862813,4110757536217,8949761632990,8128109286708,3627914812444,309610686123,2451263530402,9396457097568,6512671260271,7964874552728,1731300527733,4365203538918,544993561884,8463304645489,9770618427702,2225622313366,647636913112,9982974196369,9967573976690,1336272781859,860079329575,2334042769787,2162893083233,8546763944794,645152832473,3168573417001,7378503393067,5521497066155,650736994866,3313341264963,9724603103909,6396012718113,6583224196749,2041765943525,3463263255356,3655434365260,3454528429882,4974460888228,1790918279105,1477274049705,6784432833121,3956407352255,4180882884949,3496502986943,105649024464,2479358960073,2942916905386,47011378737,5615371294833,7697950298607,7252793261455,2912635925577,5792389260211,8576942078848,2477331142468,5523032800063,287380084462,5131457976529,998040618569,3141235428868,2219216649048,3138578859723,4978706794145,9010446522087,4580164245430,2750678728966,5118102841816,1792288283331,2505137288243,3989389847883,8982410012971,2025846410321,4267747223458,2902654048390,4311103149937,2421696555118,9183010966179,1833455752098,3401913918230,2764336092478,5436492592558,5354841591131,3188152184201,2106101273112,2636751249007,2781998750173,9744823883763,8069065583937,6879312932342,6482144431427,8726862218345,1311734321926,2295507759384,7412369405155,2325689499253,433855813129,7217822860964,6081832822975,7789637848810,7885037750916,2940387896665,1435674511625,1148441557866,2505713680072,9303622985739,4539934957953,8948229787408,9299219384028,1417534894806,1705189129530,8842894709901,2056856182248,8400574339993,1535418742104,9201497357448,6455462793343,4988586895332,8582853904226,4405681749046,286495431660,8304779115015,814105430132,6715970328164,515636525383,7794972817286)[simnum]); //define with -d simnum=$SGE_TASK_ID
sim.addSubpop("p1", 1000); }


10000 late() {
    sim.treeSeqOutput("/Users/vicentediegoortegadelvecchyo/Dropbox/Documents/DissertationThesis/PurifyingSelection/Drafts/HaplotypeDFEStandingVariation/Scripts/Sims/SLiM/synsel/make_slim_scripts/trees_test_" + simnum + ".trees");
}
