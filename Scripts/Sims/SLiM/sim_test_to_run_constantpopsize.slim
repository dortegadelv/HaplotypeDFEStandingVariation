
// set up a simple neutral simulation
initialize() {
    initializeMutationRate(1.5e-08*(2.31/3.31)*10);
    initializeTreeSeq();

    // m1 mutation type: nonsyn
    // muts added at 2.31/3.31 the mutation rate, syn muts added w/msprime
    initializeMutationType("m1", 0, "g", -0.01026, 0.184);

    // m2 mutation type: adaptive
    initializeMutationType("m2", 0.5, "s", "return runif(1,0.00125, 0.0125);");
    m2.convertToSubstitution == T;

    // m3 mutation type: cnc with DFE from Torgerson et al., 2009
    // initializeMutationType("m3", 0.5, "g", -0.004594*10, 0.0415);
    // m3.convertToSubstitution == T;

    //genomic element: exon and uses a mixture of syn and nonsyn at a 1:2.31 ratio (Huber et al.)
    initializeGenomicElementType("g1", c(m1), c(1.0)); // no synonymous muts

    //genomic element: cnc
    // initializeGenomicElementType("g2", c(m3), c(1.0));

    //read in exon and recomb info
    info_lines = readFile("/Users/vicentediegoortegadelvecchyo/Dropbox/Documents/DissertationThesis/PurifyingSelection/Drafts/HaplotypeDFEStandingVariation/Scripts/Sims/SLiM/synsel/make_slim_scripts/sim_seq_info_test.txt");

    //recombination
    rec_ends = NULL;
    rec_rates = NULL;
    for (line in info_lines[substr(info_lines, 0, 2) == "rec"])
    {
        components = strsplit(line, " ");
        rec_ends = c(rec_ends, asInteger(components[1]));
        rec_rates = c(rec_rates, asFloat(components[2]));
    }
    //multiply rec rates by scaling factor
    initializeRecombinationRate(0.5*(1-(1-2*rec_rates)^10), rec_ends);

    //exons
    for (line in info_lines[substr(info_lines, 0, 2) == "exo"])
    {
        components = strsplit(line, " ");
        exon_starts = asInteger(components[1]);
        exon_ends = asInteger(components[2]);
        initializeGenomicElement(g1, exon_starts, exon_ends);
    }

    //conserved non-coding
    //maybe incorporate this later
    //for (line in info_lines[substr(info_lines, 0, 2) == "cnc"])
    //{
    //    components = strsplit(line, " ");
    //    cnc_starts = asInteger(components[1]);
    //    cnc_ends = asInteger(components[2]);
    //    initializeGenomicElement(g2, cnc_starts, cnc_ends);
    //}
}


1:8900 fitness(m1) {
    h = mut.mutationType.dominanceCoeff;
    if (homozygous) {
        return ((1.0 + 0.5*mut.selectionCoeff)*(1.0 + 0.5*mut.selectionCoeff));
    } else {
        return (1.0 + mut.selectionCoeff * h);
    }
}


// burn-in for ancestral population
1 early() {
    setSeed(c(7354934488945,5642096947865,3633784904296,3451426865732,4962276156430,6378737052179,4773821276981,5526272986231,3969032517928,6095395127927,1736132693686,276406352073,6387738804956,1232893253624,7064474923491,9909574522280,9064993271378,8327120370105,6389823707740,4432281126585,32824162125,4023798699439,8805710880090,1473200427024,5052343234850,7533363504574,3344682279481,7354314529523,2327051220358,2909704588294,4146110005309,4049978879187,6047481766247,2900563824120,1619371659264,8508756817494,5098167332562,8941564381573,5867548073568,7017053821847,9803102419021,4092245729880,2739158138917,8505426330517,4715300448566,3153068234932,2014364784126,2948112165882,8653672068686,2614360767321,227650648497,2308900374710,4260919499804,905671406668,6665342444848,6712774554947,7232352039223,6128629253262,5015676058310,3056120148416,699358804668,3517674880422,2108212648682,5689849008016,3699738033057,6254158944562,5384265197342,9134054614675,4818333485469,2340634828508,7505267027756,2347012209415,8037848804529,1456740606876,1307976553644,5627575245761,6131812005363,5411927394255,9782593812278,7635254270587,2121026945072,3792641092196,970203578370,7300843563544,4208147327766,9324400027330,4310057362586,2248710830422,918720548068,714215051540,1303079717428,4940887082159,9787810901922,9887670170264,8701538265996,7185824851660,2852603480071,9448914576976,2275455239488,1985463592809,7753506682604,8724468819157,1450269191965,8768750713456,2274405017417,4192076650511,3176216107604,1597284055514,7535411592173,5961009454275,3292832740431,2937238719537,2801463067795,3300197293342,6877754477518,5022591794416,6232993557552,9111163453722,5512363735277,7528486983639,4291968222177,7661638569560,3973500571078,4746563258938,4937387620214,8010671159048,7087050847492,7040209355839,882091924850,9078111434847,9392070391651,6126686544151,9925156791771,2252422161125,590359371487,1935629287811,4630875369802,6650951030707,4752368211781,5277487531699,1936601094713,1748717388646,9427060813243,5023809807057,2249025905775,6522684935712,4168195207371,4550958645973,7496860458152,1350986170728,9026052548864,565822648771,9550946171390,54735292196,4872888183872,9697800577799,2975681055037,1878448674862,9584974603925,1179196282392,7928007621151,1075519627712,3373786665463,2417478070888,7297729646791,5502239231805,7025019839309,606042566250,1081070408122,5722198117999,469326211636,3174725019959,5010511004418,9072716525391,1484605061739,2086159645856,7560485631388,9864984504560,4302826118712,4478812012578,8565054148168,7415206028802,4678288747271,4812837813990,767670068896,8152545560774,1075975342869,1237855948178,3691796303497,6806504317053,4551632326969,8712334405773,9180619559861,9555895346281,7800373795322,5916591885647,891690958333,970137932499,1079266505596,3716923329501,8918976748519,9934163875945,9491835940712,9357132890686,7429236784120,8952901122930,5527285411207,5507163829454,9814879242809,3724339535359,8679400589319,7473646551941,8339632878396,7180572271561,438860870067,8148531071503,669013670193,9853879664529,9678689031401,1558761008203,2571312494417,9086020594809,196639337154,3147387884075,6142413435475,3034058311803,1915570203044,2494991370323,3174025265293,8903580854185,3408282063317,277066328992,8891670323652,6164631956565,9651678160557,8874248696992,1253050764885,6015191465753,3692510583938,1693609699635,1134923523291,6839418492901,7131426501147,6456225739796,3668682567816,4958423267945,8586039109073,6491916927227,3177256363504,7030488831301,8718704926885,3196760208752,6655748865656,614970709455,2088742951714,7600965434313,8712960825997,6945362940305,7800482691519,1762434416858,5862865499019,87432631987,8471721246163,1821201293971,7716418426316,7902035706013,1599735351772,185248671826,3580933409472,5401964607420,9384065507886,2237861028035,309669553722,4144147122348,7338270016891,87000499511,7071468954098,1676948855458,8313956333056,5918951099832,8480155934603,5204389260397,4508266957760,5933897876433,85859738508,8035466327043,4684209430224,9111800702441,7857692918032,7154498957435,6993007860402,6579800866448,8354664960973,4376830506421,8784015120970,3321201760987,209159618561,8984468977999,9421296510290,4423348386453,83684193366,3053491783560,5719267103329,8649545394354,4907977812231,9144388763063,1963437771893,7128627272693,6807229387585,2771462445380,4593436721751,48512228364,6077896468474,2464057563034,8231477273421,7420463065657,8102389970287,934888713297,8950111603062,2029643231361,2403152764250,6620219524829,9356427004893,299018767902,5659036955158,8045874287052,4168241185197,611073413905,2253413284289,9137977397268,6745147510565,2632657678743,4661519943501,1239790065755,4976994584256,8369349073836,2332971990046,3406257376831,2217974963443,8896606940776,3674381591202,2798815399291,7641279449494,4632720835374,2987913975778,3002429563878,9934749416268,2247821822769,1321343938571,7455852423291,5335682527887,3016851873540,7506246307409,1991862812440,716508391784,7824579149241,1446004619810,8308869197573,7385457536576,161673673648,5390030607058,9935407207463,8869948403855,5647936567124,3665919258499,8193979677732,1845349635599,4546068950318,3343175129800,7793180162025,9728037082461,8394020452547,3225676925870,1078297318785,777857263467,7608295902008,6826572592830,5547891743074,9588163975438,929825034379,619823258440,6751840377272,7501957024678,5461353334709,1893844799316,7592837092489,9331006173501,8068755515299,2884689963670,8187155076020,9569361591789,125137893880,9213735087066,311829720489,1378260562772,7532301089415,9974023679485,3797137227308,8574138666536,5317672431912,385997817659,9843498785439,7533191094241,5097247291568,1235741752802,9756556047481,8611548281791,1003177329092,4176664276846,1142066139826,6312981416577,8893251931059,6352344072277,8628588920816,7673447082655,8246718308896,1261478400588,9374685787632,168132971363,3653599804814,3457917100022,2918815966769,1683070520593,8015851049752,8479087562768,7145597894092,1530035346702,9860447443298,1211241093854,7480115577706,6919541501142,3069987262558,7780969342036,6738512708362,4141861696317,1992680973033,5418888456247,9957649648754,6815921784205,5143174568927,6491757276279,8059583919135,663895388928,577212014448,1357175548809,5854838965129,1957681654698,7773447873437,9611627080188,677657318518,4321816831184,6457286106481,9152666616101,769742110536,2662569990916,3400274118241,6897148967302,1116628712245,9596561738567,7793186208720,3213516026675,5038026848944,1742399799237,9381012636780,5978848192926,8124266316315,9979654642229,3994357020985,7580312845947,9730819622191,9530158548604,8942334912840,5425715434041,7263674625723,532307133181,7002702142564,1118943005663,9277323559800,1191014565453,3958180862365,3798219662637,840107690944,3349722918342,5260206932352,2664643356193,7299516753757,196826714864,6513636949151,437222916246,6883399429206,4484994116390,6276553520367,4213468880904,7186988616325,6952804769814,5829569657584,9723149626239,2109006604182,3206892387631,52522053734,3676746187530,5723435267553,3317229263201,3036065273116,532266249990,2856476930976,7416061632197,6582611209870,8582387635376,2768295991693,2826125161763,6990096651331,8993489060970,9281114943374,237101076878,7550922126913,7697891711104,2087067454368,8472130611661,4191462243359,8499075650868,6415614410721,9633677699031,3280266270324,3414302131226,827262072047,2034516691209,5440235384266,9979188475535,1231667062966,1466186849785,7518284514695,4212199218209,5715990975577,9679799437200,4430385370001,7615307200560,9284539972149,7635051579431,4379278666666,7537792048272,9523529284557,1059700431811,9304545581604,78033605507,2164331261018,9684632296479,9950287626934,9565014518096,6837191042784,7420701968956,8446027272575,5739585143273,4870474284532,1927556355413,6967800079174,3882480289637,9944538393823,1026952405532,2487109946803,8199159962892,8889875502438,2482100786032,4235499659811,7874799346394,3310512450269,7787670458563,742675119035,6978199930530,8337904243716,3132669901132,7162187452474,3509854017643,5869076480091,4433257992362,3573609796442,5193569722978,7877080553737,4790760807367,3413139503824,7168750832638,2006205751098,8901132864725,8016656411584,9947889532254,2303278760006,6477921457353,2468592406685,7837133746233,737272866577,4924399813915,3223496559824,7323314518314,4935595890793,2547529114880,5291634676592,5953586152596,1725493404051,3690545476232,710055302025,6793856817259,7630848609757,882580214039,8064745531325,7876955520325,3013597026845,4786221190356,578311520660,5404823521981,8838133193128,1579751996345,6010867013689,8311652334257,7495899480388,6679543053413,1071386424559,5766359280359,5850218362804,501199026399,8228550051961,8078658234084,9617863081460,7692435978876,2212521160039,2169665251190,1400994165903,6659835499610,3857671820533,9540322247546,1004056410081,3279426643381,4904481046322,9456441749717,8011879426594,7569617363991,5194009778690,9262422769845,8086238584677,7133511399881,5998257626359,4368316803465,6711768002802,5356734146026,6115647474152,4189772379768,8783111868569,1098160281450,7431803758572,27641240438,5114616974270,2591956709944,8349540694880,5677574152001,8199956692695,7653717431129,8676743498786,8792315328191,5881072954570,3785987848255,3149709676701,82482606188,9660843813371,4998789572238,5248327332794,2238430786336,494286079407,396672371422,4752683657351,2359819531936,5299055711623,9394458619481,2930066703689,7502634364216,8940010062091,6905916436207,2621123863517,7254563789496,9857980088837,6298664754530,9966048927784,381646364114,6898767760453,4483927617024,7670792941241,8654245043321,3454357112298,1760718925962,9691943800287,8694153986304,7375212112404,5467320285247,409162950541,5380015740606,6789377212681,4484410656134,657721828,6504755951712,9081083477832,8832267443006,2594012955810,5365605179441,6279454870088,1312243145908,8947008541018,8693919736500,3619171703827,8218060528131,7401336673531,7962263695760,1687861476781,5890439888820,3944968854214,4170580372063,2055935823452,9010792766358,7500936383160,414845458229,7344453321280,1626188801250,8215708906698,9333987013869,9019446527277,4641485250674,9555278784864,3582534584821,5731057729694,2675026977063,718390413493,1066842034840,9199682075686,5573796246701,8225230056513,9767818829617,2059523079121,4623499102276,5185260931546,3989928200556,5299382188580,7199105175778,7421084751799,3121158485070,7860831227627,1848805007989,1960033842635,4145471997293,51487509579,2774496681036,3200791191395,125884919951,1070051739462,9226551179536,8950034920102,9719087421088,1260163915082,4819641589426,2300185985983,5178402358104,4249492456900,5419107727117,1470009529690,2091260186335,6828270916890,391314510350,416133083267,1251192964058,9982391907822,313772924348,1703659541340,8606490571740,8043597067518,5052518113058,3642233209751,6725748010014,5547491470177,2939820826804,5240583969289,9063351668101,7996498361172,1255103266211,7627106052568,6528100294422,2346578544134,3599332639219,7751522792542,5948192432525,2300895195308,8824017688440,4238288265399,2791714890494,8289448188218,8870497357379,6775679484253,4290652883677,9529672780955,5113556044574,3813298451405,7863797848835,4050129213150,3268110294177,5963820899174,9270360403890,7986804906878,2993161855646,4407909583024,123229893534,9858116614087,4652094099441,1017424356594,2306351530997,303728433975,9351259032560,989452472849,5404873959219,4582201240568,598764071490,587431214386,8451664748941,5297165419362,2427723299012,3937937612807,2780912144970,6441038927186,5876030610936,1428369846447,564904705836,931901296424,7221331416175,7786744390676,8696377832243,6050510094972,6031590768104,7273560936545,2140727672813,3204447086580,5837089406314,8244750063706,8322484862827,8415547595061,3967564896144,9191402221630,202416660042,3609507783693,8727689506687,3721787812227,7170531823070,8709701324077,4955486443038,2889378124002,3251465312125,811047612610,5447723226293,9189598600319,9549844090452,3815778971033,5950635226785,9075512347347,2501787257035,7013143280481,3080529037926,7161344695421,1357653284106,8082385080096,1687677317844,8362795640977,5347148733682,2167992589486,2936375403395,4002124238676,5455897526556,2480212239620,3809249638869,8277805460062,4607557928852,7103553805447,3917094997119,7939399003627,481600873731,4938400553933,8191211763275,8166100779914,5862393522106,8763338906731,2003250139557,9535438067059,8578051248447,4869313609763,7436336784090,990777570669,3729204760396,1612974305644,1447176019379,7362574034592,8301315276185,4595606586796,7557334361347,888741933396,1498576644600,9791869766421,9586645161912,8237211579809,8077183910505,3066778372611,9634276114330,3535054711634,760035351653,2396007642047,2656780045391,8438352833267,4954680459586,9457406299048,1732616334065,2754311256303,1831283416350,9420469999253,107860767540,6715396930303,2990199830991,6555006429805,4676930053464,9534510774460,3405922339063,6377948701151,1064433295475,8377093838026,8085371327016,990253228422,5036799105677,6464560915298,6699750461068,4591986708215,4143780830146,2403752138795,9177228132110,5845684095615,9901947625637,2634347402,7494175449107,7260412511373,7151356866622,9386836288430,5289232410988,4394884254471,6940475967438,2302040076772,1903195629790,4402601413818,1947490739607,9217605929593,9733632869551,8898135878558,6447163816252,964696924544,6601158141988,9098242182922,171051314227,180621702187,4243406096085,4393344965954,2796778595812,9591685307305,3678911631604,1766899458025,599913262663,9268478837549,5378457244637,2645785359567,5288226889072,938773210833,2682869250095,1714101498262,3389517548432,6817583402862,9370212762262,6174512148052,4889943213439,5549041364510,7662762749668,8703364781257,1914556744168,4572027580410,9571257933319,6513979377957,9067235098132,1068966067356,1371195942780,9679522705612,9431741115140,7192689767623,7528796264833,3619745683332,7089386896006,7645166727760,8734949990435,4067958478698,4592958461149,1750805782251,7427091662430,6089985203508,4447754271755,9759843134294)[simnum]); //define with -d simnum=$SGE_TASK_ID
    sim.addSubpop("p1", 730);
}

// after burn-in, split off Neanderthals (p2)
7300 early() {
    sim.addSubpopSplit("p2", 100, p1);
}

// set African population size
8340 early() {
    p1.setSubpopulationSize(1447);
}

// split off Asian-Eur ancestor (p3)
8696 early() {
    sim.addSubpopSplit("p3", 186, p1);
    p1.setMigrationRates(c(p2, p3), c(0, 0.00015));
    p3.setMigrationRates(c(p1, p2), c(0.00015, 0));
}

// Neanderthal hybridization
8739 late() {
    sim.addSubpopSplit("p4", 186, p1);
    p4.setMigrationRates(c(p1,p2,p3), c(0.0, 0.1, 0.9));
}

8740 late() {
    p4.setMigrationRates(c(p1,p2,p3), c(0.00015, 0.0, 0.0));
    p3.setSubpopulationSize(0);
}

//Neanderthal sample
8748 late() {
    sim.treeSeqRememberIndividuals(sample(p2.individuals, 2));
    p2.setSubpopulationSize(0);
}

// Asian founder bottleneck
8808 early() {
    p4.setSubpopulationSize(55);
    p1.setMigrationRates(c(p4), c(7.8e-06));
    p4.setMigrationRates(c(p1), c(7.8e-06));
}

// Asian exponential growth
8808:8900 {
    newSize = asInteger(round(1.048^(sim.generation - 8808) * 55));
    p4.setSubpopulationSize(newSize);
}


8900 late() {
    sim.treeSeqOutput("/Users/vicentediegoortegadelvecchyo/Dropbox/Documents/DissertationThesis/PurifyingSelection/Drafts/HaplotypeDFEStandingVariation/Scripts/Sims/SLiM/synsel/make_slim_scripts/trees_test_" + simnum + ".trees");
}
